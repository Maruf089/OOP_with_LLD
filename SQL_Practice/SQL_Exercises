HR Schema
Employees(emp_id, emp_name, dept_id, salary, hire_date)
Departments(dept_id, dept_name)

Sales Schema
Customers(cust_id, cust_name, city)
Orders(order_id, cust_id, order_date, amount, status)

Products Schema
Products(prod_id, prod_name, category, price)
OrderItems(order_id, prod_id, quantity, unit_price)

School Schema
Students(student_id, student_name, age)
Courses(course_id, course_name)
Enrollments(enrollment_id, student_id, course_id, grade)


1. Select all employees from a department
Tables: Employees
Question: Get all employees from department dept_id = 3.

-- Answer 1
SELECT *
FROM Employees
WHERE dept_id = 3;

-- Alternative
SELECT emp_id, emp_name, dept_id, salary, hire_date
FROM Employees
WHERE dept_id = 3;


2. Order employees by salary descending
Tables: Employees
-- Answer 1
SELECT emp_id, emp_name, salary
FROM Employees
ORDER BY salary DESC;

-- Alternative (limit top 10)
SELECT emp_id, emp_name, salary
FROM Employees
ORDER BY salary DESC
LIMIT 10;


3. Get distinct cities of customers
Tables: Customers

-- Answer 1
SELECT DISTINCT city
FROM Customers;


4. Count how many orders each status has
Tables: Orders
-- Answer 1
SELECT status, COUNT(*) AS total_orders
FROM Orders
GROUP BY status;

5. Get employees with salary between 50k and 80k
Tables: Employees
-- Answer 1
SELECT emp_name, salary
FROM Employees
WHERE salary BETWEEN 50000 AND 80000;

-- Alternative (without BETWEEN)
SELECT emp_name, salary
FROM Employees
WHERE salary >= 50000
  AND salary <= 80000;


6. Get customers from specific cities
Tables: Customers

-- Answer 1
SELECT cust_name, city
FROM Customers
WHERE city IN ('Dhaka', 'Chittagong');

-- Alternative (OR)
SELECT cust_name, city
FROM Customers
WHERE city = 'Dhaka'
   OR city = 'Chittagong';

7. Search customers whose name starts with 'M'
Tables: Customers
-- Answer 1
SELECT *
FROM Customers
WHERE cust_name LIKE 'M%';

-- Alternative (case-insensitive if needed)
SELECT *
FROM Customers
WHERE LOWER(cust_name) LIKE 'm%';


8. Get top 5 highest paid employees
Tables: Employees
-- Answer 1
SELECT emp_id, emp_name, salary
FROM Employees
ORDER BY salary DESC
LIMIT 5;

9. Count total number of employees

Tables: Employees
-- Answer 1
SELECT COUNT(*) AS total_employees
FROM Employees;

-- Alternative (count by PK)
SELECT COUNT(emp_id) AS total_employees
FROM Employees;

10. Get employees hired after 2023-01-01

Tables: Employees
-- Answer 1
SELECT *
FROM Employees
WHERE hire_date > '2023-01-01';

-- Alternative (>= specific day)
SELECT *
FROM Employees
WHERE hire_date >= '2023-01-02';


11â€“20: Joins & Aggregations
11. List employees with their department names (INNER JOIN)

Tables: Employees, Departments
-- Answer 1
SELECT e.emp_name, d.dept_name
FROM Employees e
JOIN Departments d ON e.dept_id = d.dept_id;

-- Alternative (explicit INNER JOIN keyword)
SELECT e.emp_name, d.dept_name
FROM Employees AS e
INNER JOIN Departments AS d
        ON e.dept_id = d.dept_id;

12. List all departments and their employees (LEFT JOIN)

Tables: Employees, Departments
-- Answer 1
SELECT d.dept_name, e.emp_name
FROM Departments d
LEFT JOIN Employees e ON d.dept_id = e.dept_id;

-- Alternative (group by dept)
SELECT d.dept_name, COUNT(e.emp_id) AS employee_count
FROM Departments d
LEFT JOIN Employees e ON d.dept_id = e.dept_id
GROUP BY d.dept_name;


13. List customers and their orders (even if no orders)

Tables: Customers, Orders
-- Answer 1
SELECT c.cust_name, o.order_id, o.amount
FROM Customers c
LEFT JOIN Orders o ON c.cust_id = o.cust_id;

-- Alternative (show only customers with no orders)
SELECT c.cust_name
FROM Customers c
LEFT JOIN Orders o ON c.cust_id = o.cust_id
WHERE o.order_id IS NULL;


14. Get total order amount per customer

Tables: Customers, Orders
-- Answer 1
SELECT c.cust_name, SUM(o.amount) AS total_spent
FROM Customers c
JOIN Orders o ON c.cust_id = o.cust_id
GROUP BY c.cust_id, c.cust_name;

-- Alternative (order by total_spent desc)
SELECT c.cust_name, SUM(o.amount) AS total_spent
FROM Customers c
JOIN Orders o ON c.cust_id = o.cust_id
GROUP BY c.cust_id, c.cust_name
ORDER BY total_spent DESC;


15. Get number of employees in each department

Tables: Employees, Departments
-- Answer 1
SELECT d.dept_name, COUNT(e.emp_id) AS employee_count
FROM Departments d
LEFT JOIN Employees e ON d.dept_id = e.dept_id
GROUP BY d.dept_name;

-- Alternative (group by id + name)
SELECT d.dept_id, d.dept_name, COUNT(e.emp_id) AS employee_count
FROM Departments d
LEFT JOIN Employees e ON d.dept_id = e.dept_id
GROUP BY d.dept_id, d.dept_name;


âœ” Why LEFT JOIN?

Ensures all departments appear, even if they have zero employees.

Departments with no employees will show EmployeeCount = 0.

ðŸ“Œ If you want to show only departments that actually have employees, use INNER JOIN:

SELECT d.DepartmentName,
       COUNT(e.EmployeeID) AS EmployeeCount
FROM Departments d
INNER JOIN Employees e
    ON d.DepartmentID = e.DepartmentID
GROUP BY d.DepartmentID, d.DepartmentName;


16. Average salary per department

Tables: Employees, Departments
-- Answer 1
SELECT d.dept_name, AVG(e.salary) AS avg_salary
FROM Departments d
JOIN Employees e ON d.dept_id = e.dept_id
GROUP BY d.dept_name;

-- Alternative (round avg)
SELECT d.dept_name, ROUND(AVG(e.salary), 2) AS avg_salary
FROM Departments d
JOIN Employees e ON d.dept_id = e.dept_id
GROUP BY d.dept_name;


17. Get total quantity sold per product

Tables: Products, OrderItems
-- Answer 1
SELECT p.prod_name, SUM(oi.quantity) AS total_qty
FROM Products p
JOIN OrderItems oi ON p.prod_id = oi.prod_id
GROUP BY p.prod_name;

-- Alternative (group by id)
SELECT p.prod_id, p.prod_name, SUM(oi.quantity) AS total_qty
FROM Products p
JOIN OrderItems oi ON p.prod_id = oi.prod_id
GROUP BY p.prod_id, p.prod_name;


18. Get total revenue per product

Tables: Products, OrderItems
-- Answer 1
SELECT p.prod_name,
       SUM(oi.quantity * oi.unit_price) AS total_revenue
FROM Products p
JOIN OrderItems oi ON p.prod_id = oi.prod_id
GROUP BY p.prod_name;


19. List customers who made orders over 10,000 total

Tables: Customers, Orders
-- Answer 1
SELECT c.cust_name, SUM(o.amount) AS total_spent
FROM Customers c
JOIN Orders o ON c.cust_id = o.cust_id
GROUP BY c.cust_id, c.cust_name
HAVING SUM(o.amount) > 10000;

-- Alternative (subquery)
SELECT cust_name, total_spent
FROM (
  SELECT c.cust_name, SUM(o.amount) AS total_spent
  FROM Customers c
  JOIN Orders o ON c.cust_id = o.cust_id
  GROUP BY c.cust_id, c.cust_name
) t
WHERE total_spent > 10000;



20. Departments with more than 5 employees

Tables: Employees, Departments
-- Answer 1
SELECT d.dept_name, COUNT(e.emp_id) AS employee_count
FROM Departments d
JOIN Employees e ON d.dept_id = e.dept_id
GROUP BY d.dept_name
HAVING COUNT(e.emp_id) > 5;



21â€“30: Subqueries, EXISTS, Updates, Deletes
21. Find employees with salary above department average

Tables: Employees

-- Alternative (where + subquery)
SELECT emp_name, salary
FROM Employees e
WHERE salary >
      (
        SELECT AVG(e2.salary)
        FROM Employees e2
        WHERE e2.dept_id = e.dept_id
      );


22. Find customers who have never placed an order

Tables: Customers, Orders
-- Answer 1 (LEFT JOIN)
SELECT c.*
FROM Customers c
LEFT JOIN Orders o ON c.cust_id = o.cust_id
WHERE o.order_id IS NULL;

-- Alternative (NOT IN)
SELECT *
FROM Customers
WHERE cust_id NOT IN (
  SELECT DISTINCT cust_id FROM Orders
);


23. Find products that were never ordered

Tables: Products, OrderItems
-- Answer 1 (LEFT JOIN)
SELECT p.*
FROM Products p
LEFT JOIN OrderItems oi ON p.prod_id = oi.prod_id
WHERE oi.order_id IS NULL;

-- Alternative (NOT EXISTS)
SELECT *
FROM Products p
WHERE NOT EXISTS (
  SELECT 1
  FROM OrderItems oi
  WHERE oi.prod_id = p.prod_id
);


24. Increase salary by 10% for employees in dept 2

Tables: Employees
-- Answer 1
UPDATE Employees
SET salary = salary * 1.10
WHERE dept_id = 2;

-- Alternative (round to integer)
UPDATE Employees
SET salary = ROUND(salary * 1.10)
WHERE dept_id = 2;


25. Delete orders with status = 'CANCELLED'

Tables: Orders
-- Answer 1
DELETE FROM Orders
WHERE status = 'CANCELLED';

-- Alternative (safe: only older than specific date)
DELETE FROM Orders
WHERE status = 'CANCELLED'
  AND order_date < '2024-01-01';

26. Insert a new customer

Tables: Customers
-- Answer 1
INSERT INTO Customers (cust_id, cust_name, city)
VALUES (101, 'Maruf Hasan', 'Dhaka');

-- Alternative (auto-increment id, omit cust_id)
INSERT INTO Customers (cust_name, city)
VALUES ('Maruf Hasan', 'Dhaka');


27. Insert into Orders from a SELECT

Tables: Customers, Orders
-- Answer 1

INSERT INTO Orders (order_id, cust_id, order_date, amount, status)
SELECT 1001, c.cust_id, CURDATE(), 5000, 'NEW'
FROM Customers c
WHERE c.cust_name = 'Maruf Hasan';

-- Alternative (auto-increment order_id)
INSERT INTO Orders (cust_id, order_date, amount, status)
SELECT c.cust_id, CURDATE(), 5000, 'NEW'
FROM Customers c
WHERE c.cust_name = 'Maruf Hasan';



28. Get second highest salary

Tables: Employees

SELECT DISTINCT salary
FROM Employees
ORDER BY salary DESC
LIMIT 1 OFFSET 1;

28> N-th Highest Salary (MySQL LIMIT method)

SELECT DISTINCT salary
FROM Employees
ORDER BY salary DESC
LIMIT 1 OFFSET N-1;


29. Get employees who earn more than any employee in dept 3

Tables: Employees

-- Alternative (greater than max of dept 3)
SELECT *
FROM Employees
WHERE salary > (
  SELECT MAX(salary)
  FROM Employees
  WHERE dept_id = 3
);


30. Get employees whose salary is more than all total employees in dept 4

Tables: Employees

-- Alternative (greater than max)
SELECT *
FROM Employees
WHERE salary > (
  SELECT SUM(salary)
  FROM Employees
  WHERE dept_id = 4
);


31. Rank employees by salary (global rank)

Tables: Employees

âœ… 1. Using DENSE_RANK() â€“ ties get the same rank, no gaps

SELECT emp_name, salary,
       DENSE_RANK() OVER (ORDER BY salary DESC) AS salary_rank
FROM Employees
ORDER BY salary_rank;

Example Output:
emp_name	salary	salary_rank
John	90000	1
Sarah	85000	2
David	85000	2
Alice	80000	3

âœ… 2. Using RANK() â€“ ties get same rank, gaps exist

SELECT emp_name, salary,
       RANK() OVER (ORDER BY salary DESC) AS salary_rank
FROM Employees
ORDER BY salary_rank;

Example Output:
emp_name	salary	salary_rank
John	90000	1
Sarah	85000	2
David	85000	2
Alice	80000	4

âœ… 3. Using ROW_NUMBER() â€“ unique rank for every employee

SELECT emp_name, salary,
       ROW_NUMBER() OVER (ORDER BY salary DESC) AS salary_rank
FROM Employees
ORDER BY salary_rank;

Example Output:
emp_name	salary	salary_rank
John	90000	1
Sarah	85000	2
David	85000	3
Alice	80000	4



31â€“40: Window Functions, Ranking, Strings, Dates
31. Rank employees by salary (global rank)

Tables: Employees
-- Answer 1 (RANK)
SELECT emp_id, emp_name, salary,
       RANK() OVER (ORDER BY salary DESC) AS salary_rank
FROM Employees;


32. Rank employees by salary within each department

Tables: Employees
SELECT emp_id, emp_name, salary,
       ROW_NUMBER() OVER (PARTITION BY dept_id ORDER BY salary DESC) AS salary_rank
FROM Employees
ORDER BY dept_id, salary_rank

âœ… 1. Using DENSE_RANK() â€“ ties get same rank, no gaps
SELECT emp_name, dept_id, salary,
       DENSE_RANK() OVER (PARTITION BY dept_id ORDER BY salary DESC) AS dept_salary_rank
FROM Employees
ORDER BY dept_id, dept_salary_rank;

Example Output:
emp_name	dept_id	salary	dept_salary_rank
John	1	90000	1
Sarah	1	85000	2
David	1	85000	2
Alice	1	80000	3
Bob	    2	95000	1
Carol	2	90000	2



34. Get top 3 highest paid employees in each department

Tables: Employees

-- Answer 1 (ROW_NUMBER filter)

WITH ranked AS (
  SELECT emp_id, emp_name, dept_id, salary,
         ROW_NUMBER() OVER (PARTITION BY dept_id ORDER BY salary DESC) AS rn
  FROM Employees
)
SELECT *
FROM ranked
WHERE rn <= 3;
Select * From ranked where ranked_salary <= 3



35. Concatenate first and last name into full name

Assume table:
UserInfo(user_id, first_name, last_name)

-- Answer 1
SELECT user_id, CONCAT(first_name, ' ', last_name) AS full_name
FROM UserInfo;

36. Extract year and month from order_date

Tables: Orders
-- Answer 1
SELECT order_id,
       YEAR(order_date) AS order_year,
       MONTH(order_date) AS order_month
FROM Orders;


37. Get orders placed in last 30 days

Tables: Orders

Select * From Orders
Where CURDATE() - INTERVAL - 30 DAYS

38. Count orders per month

Tables: Orders

-- Alternative (group by year, month)
SELECT YEAR(order_date) AS order_year,
       MONTH(order_date) AS order_month,
       COUNT(*) AS order_count
FROM Orders
GROUP BY YEAR(order_date), MONTH(order_date);


40. Replace NULL city with 'Unknown'

Tables: Customers

-- Answer 1
SELECT cust_id, cust_name,
       COALESCE(city, 'Unknown') AS city
FROM Customers;

41â€“50: Duplicates, Anti-joins, Date Ranges

41. Find duplicate customer names

Tables: Customers

-- Answer 1
SELECT cust_name, COUNT(*) AS cnt
FROM Customers
GROUP BY cust_name
HAVING COUNT(*) > 1;


42. Delete duplicate customers keeping smallest cust_id

Tables: Customers

-- Alternative (using NOT IN)
DELETE FROM Customers
WHERE cust_id NOT IN (
  SELECT MIN(cust_id)
  FROM Customers
  GROUP BY cust_name
);



43. Find students enrolled in more than 3 courses

Tables: Enrollments, Students

-- Answer 1
SELECT s.student_name, COUNT(e.course_id) AS total_courses
FROM Students s
JOIN Enrollments e ON s.student_id = e.student_id
GROUP BY s.student_id, s.student_name
HAVING COUNT(e.course_id) > 3;

44. Find courses with no enrolled students

Tables: Courses, Enrollments

SELECT c.*
FROM Courses c
LEFT JOIN Enrollments e ON c.course_id = e.course_id
WHERE e.enrollment_id IS NULL;


45. Find overlapping bookings

Bookings(booking_id, room_id, start_date, end_date)


-- Answer 1 (self-join)
SELECT b1.booking_id AS booking1,
       b2.booking_id AS booking2,
       b1.room_id
FROM Bookings b1
JOIN Bookings b2
  ON b1.room_id = b2.room_id
 AND b1.booking_id < b2.booking_id
 AND b1.start_date < b2.end_date
 AND b2.start_date < b1.end_date;


 46.  total amount per status per customer

 Tables: Customers, Orders

 -- Alternative (just grouped)
 SELECT c.cust_name, o.status, SUM(o.amount) AS total_amount
 FROM Customers c
 JOIN Orders o ON c.cust_id = o.cust_id
 GROUP BY c.cust_name, o.status;


48. Find each customerâ€™s latest order

Tables: Customers, Orders

-- Alternative (window function)
WITH ranked AS (
  SELECT o.*,
         ROW_NUMBER() OVER (PARTITION BY cust_id ORDER BY order_date DESC, order_id DESC) AS rn
  FROM Orders o
)
SELECT *
FROM ranked
WHERE rn = 1;



49. Customers with total order > 5000 and at least 3 orders

Tables: Customers, Orders

-- Answer 1
SELECT c.cust_name,
       COUNT(o.order_id) AS order_count,
       SUM(o.amount) AS total_amount
FROM Customers c
JOIN Orders o ON c.cust_id = o.cust_id
GROUP BY c.cust_id, c.cust_name
HAVING SUM(o.amount) > 5000
   AND COUNT(o.order_id) >= 3;


50. Find departments where every employee earns more than 40k

Tables: Employees, Departments

-- Answer 1 (NOT EXISTS)
SELECT d.*
FROM Departments d
WHERE NOT EXISTS (
  SELECT 1
  FROM Employees e
  WHERE e.dept_id = d.dept_id
    AND e.salary <= 40000
);

